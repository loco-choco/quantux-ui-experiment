[gd_scene load_steps=10 format=3 uid="uid://ct5lh45t375b1"]

[ext_resource type="Script" uid="uid://bahnyrvbiy4xf" path="res://scripts/round_data_collection.gd" id="1_4mrxx"]
[ext_resource type="PackedScene" uid="uid://dvkqs1ejdovsf" path="res://scenes/map.tscn" id="1_4wyf3"]
[ext_resource type="Script" uid="uid://c2itm3ginmwxf" path="res://scripts/round_world.gd" id="1_7r4gi"]
[ext_resource type="Script" uid="uid://ck8nv36dwfxhk" path="res://scripts/round_logic.gd" id="1_i7141"]
[ext_resource type="PackedScene" uid="uid://cg55uk4s6qv0g" path="res://scenes/player.tscn" id="1_rwgxs"]
[ext_resource type="PackedScene" uid="uid://pysiho2iiyxp" path="res://scenes/hud.tscn" id="2_4wyf3"]
[ext_resource type="Script" uid="uid://cnwnruwhvc7jc" path="res://scripts/enemy_spawner.gd" id="4_k0juu"]
[ext_resource type="PackedScene" uid="uid://bnq00287k1il2" path="res://scenes/enemy.tscn" id="5_71j4m"]
[ext_resource type="Resource" uid="uid://buf48tvdokc3t" path="res://resources/enemy_waves/main_waves.tres" id="7_7r4gi"]

[node name="World" type="Node2D"]
script = ExtResource("1_7r4gi")

[node name="RoundDataCollection" type="Node" parent="." node_paths=PackedStringArray("inventory", "bag_inventory", "weapon_slot", "side_weapon_slot", "enemy_wave_logic", "player")]
unique_name_in_owner = true
process_mode = 3
script = ExtResource("1_4mrxx")
inventory = NodePath("../HUD/Inventory")
bag_inventory = NodePath("../HUD/Inventory/PanelContainer/MarginContainer/HBoxContainer/AspectRatioContainer/BagBg/Bag")
weapon_slot = NodePath("../HUD/Inventory/PanelContainer/MarginContainer/HBoxContainer/Equipment2/AspectRatioContainer/PanelContainer/WeaponSlot")
side_weapon_slot = NodePath("../HUD/Inventory/PanelContainer/MarginContainer/HBoxContainer/Equipment2/AspectRatioContainer3/PanelContainer3/SideWeaponSlot")
enemy_wave_logic = NodePath("../EnemyWaveLogic")
player = NodePath("../Player")

[node name="MouseFramingTimer" type="Timer" parent="RoundDataCollection"]
process_mode = 1
wait_time = 0.1
autostart = true

[node name="EnemyWaveFramingTimer" type="Timer" parent="RoundDataCollection"]
process_mode = 1
autostart = true

[node name="RoundLogic" type="Node" parent="." node_paths=PackedStringArray("player", "hud", "wave_logic", "wave_label", "enemies_label")]
unique_name_in_owner = true
script = ExtResource("1_i7141")
player = NodePath("../Player")
hud = NodePath("../HUD")
wave_logic = NodePath("../EnemyWaveLogic")
wave_label = NodePath("../HUD/HealthBar/Wave")
enemies_label = NodePath("../HUD/HealthBar/Enemies")

[node name="Map" parent="." instance=ExtResource("1_4wyf3")]

[node name="EnemyWaveLogic" type="Node2D" parent="." node_paths=PackedStringArray("player")]
unique_name_in_owner = true
script = ExtResource("4_k0juu")
enemy_scene = ExtResource("5_71j4m")
enemy_waves = ExtResource("7_7r4gi")
player = NodePath("../Player")
spawn_radius = 1000.0
metadata/_custom_type_script = "uid://cnwnruwhvc7jc"

[node name="NextWaveTimer" type="Timer" parent="EnemyWaveLogic"]
unique_name_in_owner = true
wait_time = 10.0
one_shot = true
autostart = true

[node name="Player" parent="." instance=ExtResource("1_rwgxs")]
unique_name_in_owner = true
position = Vector2(457, 240)

[node name="Camera2D" type="Camera2D" parent="Player"]
position = Vector2(1, 0)
position_smoothing_enabled = true
position_smoothing_speed = 20.0

[node name="HUD" parent="." node_paths=PackedStringArray("player") instance=ExtResource("2_4wyf3")]
process_mode = 3
player = NodePath("../Player")

[node name="Wave" type="Label" parent="HUD/HealthBar" index="0"]
unique_name_in_owner = true
layout_mode = 0
offset_left = -17.0
offset_top = 27.0
offset_right = 116.0
offset_bottom = 51.0
text = "Starting Round ..."
horizontal_alignment = 1

[node name="Enemies" type="Label" parent="HUD/HealthBar" index="1"]
unique_name_in_owner = true
layout_mode = 0
offset_left = -17.0
offset_top = 48.0
offset_right = 116.0
offset_bottom = 72.0
horizontal_alignment = 1

[connection signal="timeout" from="RoundDataCollection/MouseFramingTimer" to="RoundDataCollection" method="get_current_mouse_pos"]
[connection signal="timeout" from="RoundDataCollection/EnemyWaveFramingTimer" to="RoundDataCollection" method="get_current_enemies_status"]
[connection signal="item_collected" from="Player" to="HUD" method="_on_player_item_collected"]
[connection signal="item_dropped" from="HUD" to="Player" method="_on_inventory_item_dropped"]
[connection signal="item_returned" from="HUD" to="Player" method="_on_inventory_item_returned"]
[connection signal="side_weapon_slot_update" from="HUD" to="Player" method="on_side_weapon_change"]
[connection signal="weapon_slot_update" from="HUD" to="Player" method="on_weapon_change"]
[connection signal="potion_used" from="HUD/Inventory" to="Player" method="heal"]

[editable path="HUD"]
[editable path="HUD/Inventory"]
